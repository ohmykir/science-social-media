<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${user.firstName + ' ' + user.lastName + ' - –ü—Ä–æ—Ñ–∏–ª—å'}">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <link rel="stylesheet" th:href="@{/styles/user-profile.css}">
    <link rel="stylesheet" th:href="@{/styles/common.css}">
</head>
<body>

<nav class="navbar">
    <div class="nav-container">
        <a th:href="@{/}" class="logo">üî¨ SciNet</a>
        <div class="nav-links">
            <a th:href="@{/}" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
            <div sec:authorize="isAuthenticated()">
                <a th:href="@{/user(id=${currentUserId})}" class="nav-link">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                <a th:href="@{/logout}" class="nav-link btn-logout">–í—ã–π—Ç–∏</a>
            </div>
            <div sec:authorize="!isAuthenticated()">
                <a th:href="@{/login}" class="nav-link btn-login">–í–æ–π—Ç–∏</a>
            </div>
        </div>
    </div>
</nav>

<div class="container">
    <div class="user-profile">
        <div class="user-avatar">
            <img th:src="@{/images/default-avatar.png}" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        </div>
        <div class="user-info">
            <h1 class="username" th:text="${user.username}">username</h1>
            <h2 class="full-name" th:text="${user.firstName + ' ' + user.lastName}">–ò–º—è –§–∞–º–∏–ª–∏—è</h2>
            <p class="bio" th:text="${user.bio}">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
        </div>

        <div th:if="${isOwner}" class="profile-actions">
            <button id="show-upload-form" class="btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</button>
        </div>
    </div>

    <div th:if="${isOwner}" id="upload-form-container" class="upload-container" style="display: none;">
        <div class="upload-form-wrapper">
            <button id="close-upload-form" class="close-btn">&times;</button>
            <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–µ–π –∏–∑ BibTeX</h3>
            <form th:action="@{/api/import/bibtex}" method="post" enctype="multipart/form-data" id="bibtex-upload-form">
                <div class="form-group">
                    <label for="file">–í—ã–±–µ—Ä–∏—Ç–µ BibTeX —Ñ–∞–π–ª:</label>
                    <input type="file" id="file" name="file" required>
                </div>
                <button type="submit" class="btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </form>
            <div id="upload-status" class="upload-status"></div>
        </div>
    </div>


    <div class="content-wrapper">
        <div class="articles-section">
            <h3>–°—Ç–∞—Ç—å–∏ <span class="articles-count" th:text="'(' + ${userArticles.size()} + ')'">0</span></h3>

            <div class="articles-list" id="articles-container">
                <div class="article-item" th:each="article : ${userArticles}">
                    <div class="article-content">
                        <h4 class="article-title">
                            <a th:href="@{/article(id=${article.id})}" th:text="${article.title}">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</a>
                        </h4>
                        <div class="article-meta">
                            <span class="article-journal" th:text="${article.journal}">–ñ—É—Ä–Ω–∞–ª</span>
                            <span class="article-year" th:text="${article.year}">2023</span>
                        </div>
                        <div class="article-authors" th:text="${article.author}">–ê–≤—Ç–æ—Ä—ã</div>
                    </div>
                    <div class="article-actions">
                        <div class="action-item">
                            <span class="icon like-icon">‚ô•</span>
                            <span class="count" th:text="${article.likes?.size() ?: 0}">0</span>
                        </div>
                        <div class="action-item">
                            <span class="icon comment-icon">üí¨</span>
                            <span class="count" th:text="${article.comments?.size() ?: 0}">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="view-toggle">
                <button id="list-view" class="view-btn active">–°–ø–∏—Å–æ–∫</button>
                <button id="grid-view" class="view-btn">–ü–ª–∏—Ç–∫–∏</button>
            </div>
        </div>

        <div class="sidebar">
            <div class="stats-card">
                <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                <div class="stat-item">
                    <span class="stat-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:</span>
                    <span class="stat-value" th:text="${user.subscribers?.size() ?: 0}">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ü–æ–¥–ø–∏—Å–æ–∫:</span>
                    <span class="stat-value" th:text="${user.subscriptions?.size() ?: 0}">0</span>
                </div>
            </div>

            <div class="subscriptions-card" th:if="${user.subscriptions?.size() > 0}">
                <h4>–ü–æ–¥–ø–∏—Å–∫–∏</h4>
                <div class="subscription-list">
                    <div class="subscription-item" th:each="subscription : ${user.subscriptions}">
                        <a th:href="@{/user(id=${subscription.id})}"
                           th:text="${subscription.firstName + ' ' + subscription.lastName}">
                            –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/user-profile.js}"></script>
</body>
</html>