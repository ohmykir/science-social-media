<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${userProfile.user.firstName + ' ' + userProfile.user.lastName + ' - –ü—Ä–æ—Ñ–∏–ª—å'}">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <link rel="stylesheet" th:href="@{/styles/user-profile.css}">
    <link rel="stylesheet" th:href="@{/styles/common.css}">
</head>
<body>

<nav class="navbar">
    <div class="nav-container">
        <a th:href="@{/}" class="logo">üî¨ SciNet</a>
        <div class="nav-links">
            <a th:href="@{/}" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
            <div sec:authorize="isAuthenticated()">
                <a th:href="@{/user(id=${currentUserId})}" class="nav-link">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                <a th:href="@{/logout}" class="nav-link btn-logout">–í—ã–π—Ç–∏</a>
            </div>
            <div sec:authorize="!isAuthenticated()">
                <a th:href="@{/login}" class="nav-link btn-login">–í–æ–π—Ç–∏</a>
            </div>
        </div>
    </div>
</nav>

<div class="container">
    <div class="user-profile">
        <div class="user-avatar">
            <img th:if="${userProfile.user.profilePhotoPath}"
                 th:src="@{${userProfile.user.profilePhotoPath}}"
                 alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            <img th:unless="${userProfile.user.profilePhotoPath}"
                 th:src="@{/images/default-avatar.png}"
                 alt="–ê–≤–∞—Ç–∞—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é">
        </div>
        <div class="user-info">
            <h1 class="username" th:text="${userProfile.user.username}">username</h1>
            <h2 class="full-name" th:text="${userProfile.user.firstName + ' ' + userProfile.user.lastName}">–ò–º—è –§–∞–º–∏–ª–∏—è</h2>
            <p class="bio" th:text="${userProfile.user.bio}">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
        </div>

        <div class="profile-actions">
            <button th:if="${isOwner}" id="show-upload-form" class="btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</button>
            <a th:if="${isOwner}" th:href="@{/user/edit}" class="btn-secondary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
            <button th:unless="${isOwner}" class="subscribe-btn"
                    th:attr="data-user-id=${userProfile.user.id}"
                    th:text="${userProfile.subscribed} ? '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è'"></button>
        </div>
    </div>

    <div th:if="${isOwner}" id="upload-form-container" class="upload-container" style="display: none;">
        <div class="upload-form-wrapper">
            <button id="close-upload-form" class="close-btn">&times;</button>
            <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–µ–π –∏–∑ BibTeX</h3>
            <form th:action="@{/import/bibtex}" method="post" enctype="multipart/form-data" id="bibtex-upload-form">
                <div class="form-group">
                    <label for="file">–í—ã–±–µ—Ä–∏—Ç–µ BibTeX —Ñ–∞–π–ª:</label>
                    <input type="file" id="file" name="file" accept=".bib" required>
                </div>
                <button type="submit" class="btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </form>
            <div id="upload-status" class="upload-status"></div>
        </div>
    </div>

    <!-- Flash messages -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${warnings}" class="alert alert-warning">
        <div th:each="warning : ${warnings}" th:text="${warning}"></div>
    </div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <div class="content-wrapper">
        <div class="articles-section">
            <div class="articles-header">
                <h3>–°—Ç–∞—Ç—å–∏ <span class="articles-count" th:text="'(' + ${userProfile.articles.size()} + ')'">0</span></h3>
                <select id="sort-selector" class="sort-select">
                    <option value="date" th:selected="${currentSort == 'date'}">–ü–æ –¥–∞—Ç–µ</option>
                    <option value="title" th:selected="${currentSort == 'title'}">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                    <option value="likes" th:selected="${currentSort == 'likes'}">–ü–æ –ª–∞–π–∫–∞–º</option>
                    <option value="comments" th:selected="${currentSort == 'comments'}">–ü–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º</option>
                    <option value="year" th:selected="${currentSort == 'year'}">–ü–æ –≥–æ–¥—É</option>
                </select>
            </div>

            <div class="articles-list" id="articles-container">
                <div class="article-item" th:each="article : ${userProfile.articles}">
                    <div class="article-content">
                        <h4 class="article-title">
                            <a th:href="@{/article(id=${article.article.id})}" th:text="${article.article.title}">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</a>
                        </h4>
                        <div class="article-meta">
                            <span class="article-journal" th:text="${article.article.journal}">–ñ—É—Ä–Ω–∞–ª</span>
                            <span class="article-year" th:text="${article.article.year}">2023</span>
                        </div>
                        <div class="article-authors" th:text="${article.article.author}">–ê–≤—Ç–æ—Ä—ã</div>
                    </div>
                    <div class="article-actions">
                        <div class="action-item">
                            <span class="icon like-icon">‚ô•</span>
                            <span class="count" th:text="${article.likeCount}">0</span>
                        </div>
                        <div class="action-item">
                            <span class="icon comment-icon">üí¨</span>
                            <span class="count" th:text="${article.commentCount}">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="view-toggle">
                <button id="list-view" class="view-btn active">–°–ø–∏—Å–æ–∫</button>
                <button id="grid-view" class="view-btn">–ü–ª–∏—Ç–∫–∏</button>
            </div>
        </div>

        <div class="sidebar">
            <div class="stats-card">
                <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                <div class="stat-item clickable" id="show-subscribers">
                    <span class="stat-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:</span>
                    <span class="stat-value" th:text="${userProfile.subscriberCount}">0</span>
                </div>
                <div class="stat-item clickable" id="show-subscriptions">
                    <span class="stat-label">–ü–æ–¥–ø–∏—Å–æ–∫:</span>
                    <span class="stat-value" th:text="${userProfile.subscriptionCount}">0</span>
                </div>
            </div>

            <!-- Modal –¥–ª—è —Å–ø–∏—Å–∫–∞ -->
            <div id="users-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3 id="modal-title"></h3>
                    <div id="users-list"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/user-profile.js}"></script>
</body>
</html>